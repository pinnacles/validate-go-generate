name: Validate Go Generate
description: Validate Go Generate
inputs:
  root_path:
    description: application root path
    default: ./
  commit:
    description: commit
    default: 'false'
  commit-message:
    description: commit message
    default: 'fix: generate files'
  commit-actor:
    description: commit actor
    default: 'github_actions'
runs:
  using: composite
  steps:
    - name: Remove generated files
      run: git grep --name-only -E '^// Code generated by .*. DO NOT EDIT.$' | xargs rm -rf -
      shell: bash
    - name: Generate files
      run: go generate ./...
      shell: bash
    - if: inputs.commit == 'true'
      uses: EndBug/add-and-commit@v9
      with:
        message: ${{ inputs.commit-message }}
        default_author: ${{ inputs.commit-actor }}
        push: true
    - if: inputs.commit == 'false'
      name: Check diff
      run: git add . && git diff HEAD --name-only --exit-code
      shell: bash

